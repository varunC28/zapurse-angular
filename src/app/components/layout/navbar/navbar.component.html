<div class="navbar-wrapper">
    <!-- Theme Toggle - Top Right Fixed (Desktop Only) -->
    <div class="fixed-toggle hidden md:block">
        <app-theme-toggle></app-theme-toggle>
    </div>

    <!-- Floating Pill Navbar - Top Center -->
    <nav class="floating-pill-nav" [ngClass]="{'nav-scrolled': isScrolled()}">
        <div class="pill-container">
            <!-- Mobile Toggle + Logo Area -->
            <div class="flex items-center md:hidden w-full justify-between  gap-4">
                <a routerLink="/" (click)="onLogoClick($event); closeMobileMenu()" class="flex items-center">
                    <img src="assets/brand-logo/logo.png" alt="Zapurse logo" class="h-8 w-auto"
                        onerror="this.src='https://placehold.co/100x40?text=Zapurse'" />
                </a>

                <div class="flex items-center gap-2">
                    <app-theme-toggle></app-theme-toggle>
                    <button class="p-2 text-black dark:text-white" (click)="toggleMobileMenu()">
                        <lucide-icon [img]="Menu" [size]="20"></lucide-icon>
                    </button>
                </div>
            </div>

            <!-- Desktop Nav Links -->
            <div class="hidden md:flex items-center">
                <!-- First 3 Links -->
                @for (link of navLinks.slice(0, 3); track link.name) {
                <div class="relative group">
                    @if (link.isDropdown) {
                    <div class="pill-nav-link flex items-center gap-1 cursor-pointer">
                        <span>{{ link.name }}</span>
                        <lucide-icon [img]="ChevronDown" [size]="14"></lucide-icon>

                        <!-- Dropdown -->
                        <div
                            class="absolute top-full left-1/2 -translate-x-1/2 mt-4 w-48 bg-white dark:bg-gray-950 border border-gray-100 dark:border-gray-800 rounded-2xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 overflow-hidden backdrop-blur-xl">
                            @for (item of link.items; track item.name) {
                            <a [routerLink]="item.path" [fragment]="item.fragment"
                                routerLinkActive="text-primary font-bold bg-gray-50 dark:bg-gray-900"
                                class="block px-6 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-green-900/20 hover:text-primary transition-all">
                                {{ item.name }}
                            </a>
                            }
                        </div>
                    </div>
                    } @else {
                    <a [routerLink]="link.path" routerLinkActive="active-pill"
                        [routerLinkActiveOptions]="{ exact: true }" class="pill-nav-link">
                        {{ link.name }}
                    </a>
                    }
                </div>
                }

                <!-- Integrated Logo -->
                <a routerLink="/" (click)="onLogoClick($event); closeMobileMenu()" class="pill-logo-box mx-4">
                    <img src="assets/brand-logo/logo.png" alt="Zapurse logo" class="pill-brand-logo"
                        onerror="this.src='https://placehold.co/100x40?text=Zapurse'" />
                </a>

                <!-- Remaining Links -->
                @for (link of navLinks.slice(3); track link.name) {
                <div class="relative group">
                    @if (link.isDropdown) {
                    <div class="pill-nav-link flex items-center gap-1 cursor-pointer">
                        <span>{{ link.name }}</span>
                        <lucide-icon [img]="ChevronDown" [size]="14"></lucide-icon>

                        <!-- Dropdown -->
                        <div
                            class="absolute top-full left-1/2 -translate-x-1/2 mt-4 w-48 bg-white dark:bg-gray-950 border border-gray-100 dark:border-gray-800 rounded-2xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 overflow-hidden backdrop-blur-xl">
                            @for (item of link.items; track item.name) {
                            <a [routerLink]="item.path" [fragment]="item.fragment"
                                routerLinkActive="text-primary font-bold bg-gray-50 dark:bg-gray-900"
                                class="block px-6 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-green-900/20 hover:text-primary transition-all">
                                {{ item.name }}
                            </a>
                            }
                        </div>
                    </div>
                    } @else {
                    <a [routerLink]="link.path" routerLinkActive="active-pill"
                        [routerLinkActiveOptions]="{ exact: true }" class="pill-nav-link">
                        {{ link.name }}
                    </a>
                    }
                </div>
                }
            </div>

        </div>
    </nav>
</div>

<!-- Mobile Menu Overlay -->

@if (mobileMenuOpen()) {
<div
    class="fixed inset-0 h-[150dvh] bg-white-50/90 dark:bg-gray-950/95 backdrop-blur-2xl z-[100] flex flex-col p-8 md:hidden animate-in fade-in zoom-in duration-300">
    <div class="flex items-center justify-between mb-12">
    </div>

    <div class="flex flex-col space-y-8 mt-10 mb-12 text-xl">
        @for (link of navLinks; track link.name) {
        <div>
            @if (link.isDropdown) {
            <div class="flex flex-col">
                <button (click)="toggleDropdown(link.name)" class="flex items-center justify-between w-full">
                    {{ link.name }}
                    <lucide-icon [img]="ChevronDown" [size]="24" class="transition-transform"
                        [class.rotate-180]="openDropdown() === link.name"></lucide-icon>
                </button>
                @if (openDropdown() === link.name) {
                <div class="flex flex-col pl-6 mt-6 space-y-4 border-l-2 border-primary">
                    @for (item of link.items; track item.name) {
                    <a [routerLink]="item.path" [fragment]="item.fragment" (click)="closeMobileMenu()"
                        class=" font-medium text-black-600 dark:text-gray-400">
                        {{ item.name }}
                    </a>
                    }
                </div>
                }
            </div>
            } @else {
            <a [routerLink]="link.path" (click)="closeMobileMenu()" routerLinkActive="mobile-active-link"
                [routerLinkActiveOptions]="{exact: link.path === '/'}" class="mobile-link">
                {{ link.name }}
            </a>
            }
        </div>
        }
    </div>

    <div class="mt-auto space-y-4">
        <p class="text-sm font-bold uppercase tracking-widest">Connect</p>
        <div class="flex items-center gap-3 text-2xl font-black heading-gradient">
            <lucide-icon [img]="Phone" [size]="24"></lucide-icon>
            <a href="tel:+916262629831" class="mobile-link">+91 62626 29831</a>
        </div>
    </div>
</div>

}